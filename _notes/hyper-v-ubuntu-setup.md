---
layout: note
title: Hyper-V Setup with Ubuntu 22.04 and SSH Key Generation
draft: false
active: false
date: 2025-05-02 14:44:00 +0200
author: Victor Hachard
categories: ['System Administration']
---

## Overview  

This guide outlines the steps to set up a virtual machine (VM) on Hyper-V with an Ubuntu 22.04 image, generate SSH keys using PuTTYgen, and configure SSH on Windows for quick access to the VM.

## Setting Up Hyper-V with Ubuntu 22.04

### Enable Hyper-V on Windows

Before you can create a virtual machine (VM), you need to enable Hyper-V on your Windows machine.

**Open PowerShell as Administrator** and run the following command:

```bash
dism.exe /Online /Enable-Feature /All /FeatureName:Microsoft-Hyper-V-All /NoRestart
```

Restart your computer for the changes to take effect.

### Create a New Virtual Machine in Hyper-V

**Open Hyper-V Manager** from the start menu.

In Hyper-V Manager, click **New** > **Virtual Machine** to open the New Virtual Machine Wizard.

Follow the wizard steps to configure the VM:
   * Choose a name for your VM (e.g., `ubuntu-22.04`).
   * Assign memory (e.g., 4GB or more).
   * Select **Generation 2**.
   * Attach the **Ubuntu 22.04 ISO** to the virtual DVD drive.

Proceed through the remaining steps, configure your virtual disk, and finish the wizard.

### Install Ubuntu 22.04

Start the newly created VM from Hyper-V Manager.

The VM will boot from the Ubuntu 22.04 ISO. Follow the on-screen instructions to complete the installation of Ubuntu 22.04.

Set up your username, password, and select your desired configurations.

## Generating an SSH Key with PuTTYgen

### Download and Install PuTTY

If you don't already have PuTTY installed, you can download it from the [official website](https://www.putty.org/).

### Generate SSH Key Pair with PuTTYgen

Open **PuTTYgen** from the Start menu.

Select the key type as **RSA** and set **Number of bits in a generated key** to **2048**.

Click on **Generate** and move your mouse randomly in the window to generate the key.

Once the key is generated, enter a **passphrase** to secure your private key (optional but recommended).

Save both the **private key** and **public key** to your desired location.

## Configuring SSH Access to Ubuntu 22.04

### Copy the Public Key to Ubuntu VM

**Open Ubuntu on Hyper-V** and log in using the credentials you created during installation.

On the VM, open the terminal and create the `.ssh` directory:

```bash
mkdir -p ~/.ssh
chmod 700 ~/.ssh
```

**Copy the Public Key** generated by PuTTYgen to the Ubuntu VM:

```bash
nano ~/.ssh/authorized_keys
```

Paste the contents of the **public key** (the file you saved with the `.pub` extension) into the `authorized_keys` file.

Save and close the file by pressing `Ctrl + X`, then `Y` to confirm changes, and `Enter`.

Set the appropriate permissions:

```bash
chmod 600 ~/.ssh/authorized_keys
```

### Install OpenSSH Server on Ubuntu

If you haven't already installed the SSH server on Ubuntu, you can install it using the following command:

```bash
sudo apt update
sudo apt install openssh-server -y
```

Check the status of the SSH service:

```bash
sudo systemctl status ssh
```

If SSH is not running, start it with:

```bash
sudo systemctl start ssh
```

Enable it to start automatically on boot:

```bash
sudo systemctl enable ssh
```

### Find the IP Address of the Ubuntu VM

In the Ubuntu terminal, run:

```bash
ip a
```

Find the IP address associated with your network interface (likely `eth0` or `ens33`).

## Quick SSH Setup with SSH Config on Windows

To avoid typing the full IP address and path to the private key each time, you can set up an SSH config file.

Create a new file at `C:\Users\<YourUsername>\.ssh\config` (if it doesn't exist).

Add the following configuration:

```text
Host ubuntu-vm
  HostName <IP_ADDRESS>
  User <your_ubuntu_username>
  IdentityFile C:\path\to\private\key.ppk
```

Now, you can simply open a terminal and run:

```bash
ssh ubuntu-vm
```

This will automatically connect to the Ubuntu VM without needing to manually enter the IP address or specify the key.
